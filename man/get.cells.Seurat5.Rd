% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/preprocess.R
\name{get.cells.Seurat5}
\alias{get.cells.Seurat5}
\title{Create .cells Object from Seurat v5 Object}
\usage{
get.cells.Seurat5(
  .seurat.obj,
  .meta,
  .sample.var,
  .assay = "RNA",
  .layer.pattern = "counts",
  .min.cells.per.sample = 10,
  .compress = FALSE,
  .verbose = TRUE
)
}
\arguments{
\item{.seurat.obj}{Seurat v5 object containing layered RNA data. Must use Assay5 class.}

\item{.meta}{Data frame with sample-level metadata. Rownames must be sample IDs matching values
in \code{.seurat.obj@meta.data[[.sample.var]]}. Required for filtering valid samples.}

\item{.sample.var}{Character: column name in \code{.seurat.obj@meta.data} identifying which sample
each cell belongs to (e.g., "sample_id", "Sample", "orig.ident").}

\item{.assay}{Character: assay name to extract. Default "RNA".}

\item{.layer.pattern}{Character: pattern to match layer names. Default "counts" matches layers
containing count data (e.g., "counts.Sample1", "counts.Sample2"). Uses \code{fixed = TRUE} matching.}

\item{.min.cells.per.sample}{Integer: minimum cells required per sample. Samples with fewer cells
are excluded. Default 10.}

\item{.compress}{Logical: compress RDS files? Default FALSE for faster I/O.}

\item{.verbose}{Logical: print progress messages? Default TRUE.}
}
\value{
Named list of file paths to temporary RDS files, one per sample. Only includes samples
meeting minimum cell threshold and present in \code{.meta}.
}
\description{
Converts a Seurat v5 object with layered data into tinydenseR's .cells format. Handles Seurat's
v5 assay structure where data is split across multiple layers. Each sample's cells are extracted,
combined across layers, and saved as temporary RDS files.
}
\details{
Seurat v5 uses a layered assay structure where data for different samples may be stored in
separate layers. This function:
\enumerate{
\item Identifies all layers matching \code{.layer.pattern}
\item Finds common genes across all layers
\item Extracts cells for each sample across matching layers
\item Combines layer data into single sparse matrix per sample
\item Saves as temporary RDS files for memory-efficient processing
}

Only samples appearing in both the Seurat object and \code{.meta} rownames are processed.
}
\examples{
\dontrun{
# Load example data
trajectory_data <- fetch_trajectory_data()
sim_trajectory.meta <- trajectory_data$meta |>
  dplyr::select(Condition, Replicate, Sample) |>
  unique()
rownames(sim_trajectory.meta) <- sim_trajectory.meta$Sample

# Create Seurat v5 object from SCE data
# Extract counts for two samples
counts.A_R1 <- SingleCellExperiment::counts(trajectory_data$SCE)[, 
                 trajectory_data$SCE$Sample == "A_R1"]
counts.B_R1 <- SingleCellExperiment::counts(trajectory_data$SCE)[, 
                 trajectory_data$SCE$Sample == "B_R1"]
combined.counts <- cbind(counts.A_R1, counts.B_R1)

# Build cell metadata
cell.meta <- data.frame(
  sample_id = c(rep("A_R1", ncol(counts.A_R1)),
                rep("B_R1", ncol(counts.B_R1))),
  row.names = colnames(combined.counts)
)

# Create Seurat v5 object
seurat.obj <- CreateSeuratObject(counts = combined.counts,
                                 meta.data = cell.meta)
seurat.obj[["RNA"]] <- as(seurat.obj[["RNA"]], "Assay5")
seurat.obj <- JoinLayers(seurat.obj)

# Convert to .cells format
cells <- get.cells.Seurat5(.seurat.obj = seurat.obj,
                           .meta = sim_trajectory.meta[c("A_R1", "B_R1"), ],
                           .sample.var = "sample_id")

# Use in tinydenseR workflow
lm.obj <- setup.lm.obj(.cells = cells,
                       .meta = sim_trajectory.meta[c("A_R1", "B_R1"), ],
                       .assay.type = "RNA")
}

}
\seealso{
\code{\link{get.cells}} for automatic format detection,
\code{\link{get.cells.Seurat}} for Seurat v4 objects,
\code{\link{setup.lm.obj}} for next workflow step
}
