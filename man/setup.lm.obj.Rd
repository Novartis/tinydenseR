% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/landmarks.R
\name{setup.lm.obj}
\alias{setup.lm.obj}
\title{Initialize tinydenseR object for landmark-based analysis}
\usage{
setup.lm.obj(
  .cells,
  .meta,
  .markers = NULL,
  .harmony.var = NULL,
  .assay.type = "cyto",
  .verbose = TRUE,
  .seed = 123,
  .prop.landmarks = 0.1,
  .n.threads = if (is.hpc()) {
     max(RhpcBLASctl::blas_get_num_procs(),
    RhpcBLASctl::omp_get_num_procs(), RhpcBLASctl::omp_get_max_threads(), na.rm = TRUE)

    } else {
     parallel::detectCores(logical = TRUE)
 }
)
}
\arguments{
\item{.cells}{A named list of file paths (character strings) pointing to RDS files,
each containing one expression matrix per sample. For RNA: sparse matrix (dgCMatrix)
with genes as rows and cells as columns. For cytometry: matrix with cells as rows and
markers as columns. List names become sample identifiers.}

\item{.meta}{A data.frame with sample-level metadata. Rownames must match names in
\code{.cells} exactly. Used for batch correction and downstream modeling.}

\item{.markers}{Character vector of marker names to use for landmark identification.
Only applicable for \code{.assay.type = "cyto"}. If NULL, uses all markers from
the first sample. Ignored for RNA data (uses HVG selection instead).}

\item{.harmony.var}{Character vector of column names from \code{.meta} to use for
Harmony batch correction. If NULL, no batch correction is performed.}

\item{.assay.type}{Character string: "cyto" for cytometry (default) or "RNA" for
scRNA-seq. Determines normalization strategy and feature selection approach.}

\item{.verbose}{Logical, whether to print progress messages. Default TRUE.}

\item{.seed}{Integer for random seed to ensure reproducibility. Default 123.}

\item{.prop.landmarks}{Numeric between 0 and 1 specifying proportion of cells to
sample as landmarks. Default 0.1 (10\%). Total landmarks capped at about 5000 regardless.}

\item{.n.threads}{Integer for parallel processing. Default automatically detects
maximum available threads (using BLAS settings on HPC, or \code{detectCores()} locally).}
}
\value{
A list object with initialized structure containing:
\describe{
\item{\code{$cells}}{Input file paths}
\item{\code{$metadata}}{Sample metadata with added cell count columns}
\item{\code{$key}}{Named vector mapping future landmarks to samples}
\item{\code{$spec}}{Specifications including \code{n.cells}, \code{n.perSample}}
\item{\code{$assay.type}}{Assay type ("cyto" or "RNA")}
\item{\code{$markers}}{Marker list (cytometry only)}
\item{\code{$harmony.var}}{Batch variables (if provided)}
\item{Empty slots}{lm, scaled.lm, raw.lm, pca, graph, map, etc. - populated by downstream functions}
}
}
\description{
Creates and validates the main tinydenseR object structure that will hold
expression data, metadata, and analysis results throughout the workflow.
This is the required first step before landmark identification.
}
\details{
This function:
\enumerate{
\item Validates input data structure and compatibility
\item Calculates the number of landmarks to sample per sample (max 5000 total)
\item Creates a "key" vector mapping landmarks to samples
\item Initializes empty slots for downstream analyses (PCA, graph, mapping)
\item Performs quality checks (warns if sample sizes vary >10-fold)
}

The landmark sampling strategy aims for proportional representation across samples
while capping total landmarks at 5000 for computational efficiency. Smaller samples
may have relatively more landmarks sampled to ensure adequate representation.
}
\examples{
\dontrun{
# Prepare data (from README workflow)
.meta <- get.meta(.obj = sim_trajectory, .sample.var = "Sample")
.cells <- get.cells(.exprs = sim_trajectory, 
                    .meta = .meta,
                    .sample.var = "Sample")

# Basic setup for RNA data
lm.cells <- setup.lm.obj(
  .cells = .cells,
  .meta = .meta,
  .assay.type = "RNA",
  .prop.landmarks = 0.15
)

# Cytometry workflow with marker selection
lm.cells <- setup.lm.obj(
  .cells = .cells,
  .meta = .meta,
  .markers = c("CD3", "CD4", "CD8", "CD19"),
  .assay.type = "cyto"
)

# RNA workflow with batch correction
lm.cells <- setup.lm.obj(
  .cells = .cells,
  .meta = .meta,
  .harmony.var = "batch",
  .assay.type = "RNA"
)
}
}
