% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/lm.graph.embed.R
\name{lm.cluster}
\alias{lm.cluster}
\title{Leiden clustering of landmarks}
\usage{
lm.cluster(
  .lm.obj,
  .cl.method = "snn",
  .cl.resolution.parameter = 0.8,
  .seed = 123,
  .verbose = TRUE,
  .small.size = 3
)
}
\arguments{
\item{.lm.obj}{A tinydenseR object with \code{$graph} component from \code{get.graph}.}

\item{.cl.method}{Character specifying clustering method: "snn" (shared nearest neighbors)
or "fgraph" (fuzzy graph from UMAP). Default "snn".}

\item{.cl.resolution.parameter}{Numeric resolution for Leiden clustering (default 0.8).
Internally scaled by 1e-3 for CPM objective. Higher values
yield finer/more clusters.}

\item{.seed}{Integer seed for reproducibility (default 123).}

\item{.verbose}{Logical for progress messages (default TRUE).}

\item{.small.size}{Integer threshold for straggler absorption (default 3). Clusters smaller
than this are merged into most connected neighbors.}
}
\value{
Updated \code{.lm.obj} with \code{$graph$clustering} containing:
\itemize{
\item \code{ids}: Factor of cluster assignments for each landmark
\item \code{median.exprs}: Matrix of mean expression per cluster. For RNA: top features
from PCA rotation (6 genes per PC: 3 highest, 3 lowest loadings). For cytometry: all markers.
\item \code{pheatmap}: Heatmap object showing cluster profiles
}
}
\description{
Applies Leiden community detection to partition landmarks into clusters based on either
the SNN graph or UMAP fuzzy graph. Clusters are used for visualization and as a coarser
grouping for statistical testing. This is a wrapper around \code{leiden.cluster}.
}
\details{
For RNA data, the heatmap displays top contributors to each principal component (6 genes
per PC: 3 most positive, 3 most negative loadings). For cytometry, all markers are shown.

The fuzzy graph method ("fgraph") uses probabilistic UMAP edges (pruned with tolerance 1/20
to remove weak connections) and may produce more visually coherent clusters in UMAP space.
The SNN method uses Jaccard similarity of k-NN overlaps and often gives more stable results
for downstream statistics.
}
\examples{
\dontrun{
# After graph construction
lm.cells <- setup.lm.obj(.cells = .cells, .meta = .meta) |>
  get.landmarks() |>
  get.graph()

# Extract clustering (called internally by get.graph)
lm.cells <- lm.cluster(lm.cells)

# Higher resolution clustering
lm.cells <- lm.cluster(lm.cells, .cl.resolution.parameter = 200)

# Use fuzzy graph instead of SNN
lm.cells <- lm.cluster(lm.cells, .cl.method = "fgraph")
}

}
\seealso{
\code{\link{leiden.cluster}}, \code{\link{get.graph}}
}
